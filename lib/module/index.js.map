{"version":3,"names":["NativeEventEmitter","NativeModules","Platform","NativeRealtimeAudioAnalyzer","LINKING_ERROR","select","ios","default","legacyCandidateNames","getLegacyModule","name","m","turboModule","legacyModule","RealtimeAudioAnalysisModule","console","error","Object","keys","filter","key","includes","Error","EVENT_ON_DATA","EVENT_COMPAT","eventEmitter","addListenerCompat","eventOrListener","maybeListener","addListener","eventName","listener","TypeError","removeListenersCompat","eventOrCount","removeAllListeners","RealtimeAudioAnalyzer","startAnalysis","config","stopAnalysis","isAnalyzing","getAnalysisConfig","start","_RealtimeAudioAnalysi","fn","stop","_RealtimeAudioAnalysi2","isRunning","_RealtimeAudioAnalysi3","onData","removeListeners","removeSubscription","subscription","_subscription$remove","remove","call"],"sources":["index.ts"],"sourcesContent":["import { NativeEventEmitter, NativeModules, Platform } from 'react-native';\nimport NativeRealtimeAudioAnalyzer, {\n  type AnalysisConfig,\n  type Spec as TurboSpec,\n} from './NativeRealtimeAudioAnalyzer';\n\nconst LINKING_ERROR =\n  `The package 'react-native-realtime-audio-analysis' doesn't seem to be linked. Make sure:\\n\\n` +\n  Platform.select({ ios: \"- You have run 'cd ios && pod install'\\n\", default: '' }) +\n  '- You rebuilt the app after installing the package\\n' +\n  '- You are not using Expo Go\\n';\n\nconst legacyCandidateNames = [\n  'RealtimeAudioAnalyzer', // expected (matches getName())\n  'RealtimeAudioAnalyzerModule', // occasional legacy naming\n] as const;\n\nfunction getLegacyModule(): any | null {\n  for (const name of legacyCandidateNames) {\n    const m = (NativeModules as any)[name];\n    if (m) return m;\n  }\n  return null;\n}\n\n// Turbo module can be null until Android is truly Turbo-registered\nconst turboModule: TurboSpec | null = (NativeRealtimeAudioAnalyzer ?? null) as TurboSpec | null;\nconst legacyModule: any | null = getLegacyModule();\n\n// Prefer turbo when available, otherwise legacy\nconst RealtimeAudioAnalysisModule: any | null = turboModule ?? legacyModule;\n\nif (!RealtimeAudioAnalysisModule) {\n  console.error(\n    'Available NativeModules:',\n    Object.keys(NativeModules).filter(\n      (key) =>\n        key.includes('Audio') ||\n        key.includes('Realtime') ||\n        key.includes('Platform') ||\n        key.includes('Constants')\n    )\n  );\n  throw new Error(LINKING_ERROR);\n}\n\nexport type { AnalysisConfig };\n\nexport interface AudioAnalysisEvent {\n  frequencyData: number[];\n  timeData: number[];\n  volume: number;\n  peak: number;\n  timestamp: number;\n  rms?: number;\n  fft?: number[];\n}\n\nconst EVENT_ON_DATA = 'RealtimeAudioAnalyzer:onData';\nconst EVENT_COMPAT = 'AudioAnalysisData';\n\n// NativeEventEmitter requires a module instance on iOS; safe to pass on Android too.\nconst eventEmitter = new NativeEventEmitter(RealtimeAudioAnalysisModule as any);\n\ntype Subscription = { remove: () => void };\n\n/**\n * Backward-compatible listener:\n * - addListener(callback) -> listens to default EVENT_ON_DATA\n * - addListener(eventName, callback) -> listens to custom eventName\n *\n * This prevents: \"2nd argument must be a function.\"\n */\nfunction addListenerCompat(\n  eventOrListener: string | ((e: AudioAnalysisEvent) => void),\n  maybeListener?: (e: AudioAnalysisEvent) => void\n): Subscription {\n  // Style A: addListener(callback)\n  if (typeof eventOrListener === 'function') {\n    return eventEmitter.addListener(EVENT_ON_DATA, eventOrListener);\n  }\n\n  // Style B: addListener(eventName, callback)\n  const eventName = eventOrListener;\n  const listener = maybeListener;\n\n  if (typeof listener !== 'function') {\n    throw new TypeError(\n      `RealtimeAudioAnalyzer.addListener(eventName, listener): listener must be a function`\n    );\n  }\n\n  return eventEmitter.addListener(eventName, listener);\n}\n\nfunction removeListenersCompat(eventOrCount?: string | number) {\n  // If user passes a specific event name\n  if (typeof eventOrCount === 'string') {\n    eventEmitter.removeAllListeners(eventOrCount);\n    return;\n  }\n\n  // If user passes a count (RN's old EventEmitter signature)\n  // We can't reliably remove by count; remove our known events safely.\n  eventEmitter.removeAllListeners(EVENT_ON_DATA);\n  eventEmitter.removeAllListeners(EVENT_COMPAT);\n}\n\nconst RealtimeAudioAnalyzer = {\n  // Core methods\n  startAnalysis(config: AnalysisConfig = {}): Promise<void> {\n    return RealtimeAudioAnalysisModule.startAnalysis(config);\n  },\n\n  stopAnalysis(): Promise<void> {\n    return RealtimeAudioAnalysisModule.stopAnalysis();\n  },\n\n  isAnalyzing(): Promise<boolean> {\n    return RealtimeAudioAnalysisModule.isAnalyzing();\n  },\n\n  getAnalysisConfig(): Promise<AnalysisConfig> {\n    return RealtimeAudioAnalysisModule.getAnalysisConfig();\n  },\n\n  // Backward-compatible aliases\n  start(config: AnalysisConfig = {}): Promise<void> {\n    const fn = RealtimeAudioAnalysisModule.start ?? RealtimeAudioAnalysisModule.startAnalysis;\n    return fn(config);\n  },\n\n  stop(): Promise<void> {\n    const fn = RealtimeAudioAnalysisModule.stop ?? RealtimeAudioAnalysisModule.stopAnalysis;\n    return fn();\n  },\n\n  isRunning(): Promise<boolean> {\n    const fn = RealtimeAudioAnalysisModule.isRunning ?? RealtimeAudioAnalysisModule.isAnalyzing;\n    return fn();\n  },\n\n  // Recommended explicit subscription helper (does not break existing API)\n  onData(listener: (e: AudioAnalysisEvent) => void): Subscription {\n    if (typeof listener !== 'function') {\n      throw new TypeError('RealtimeAudioAnalyzer.onData(listener): listener must be a function');\n    }\n    return eventEmitter.addListener(EVENT_ON_DATA, listener);\n  },\n\n  // Event emitter API (backward compatible + safer)\n  addListener: addListenerCompat,\n  removeListeners: removeListenersCompat,\n  removeSubscription: (subscription: any) => subscription?.remove?.(),\n};\n\nexport default RealtimeAudioAnalyzer;"],"mappings":"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","ignoreList":[]}