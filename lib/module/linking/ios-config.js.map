{"version":3,"names":["fs","path","IOSConfigManager","configurePodfile","projectRoot","moduleConfig","podfilePath","findPodfile","success","message","error","content","readFileSync","isAlreadyConfigured","modifiedFiles","modifiedContent","modifyPodfileContent","backupPath","writeFileSync","basename","Error","String","iosPath","join","existsSync","podPattern","RegExp","name","test","iosDir","relativePath","relative","modulePath","podStatement","targetRegex","match","targetContent","newTargetContent","replace","podRegex","pods","length","lastPod","lastPodIndex","lastIndexOf","insertIndex","slice","validateIOSProject","getPodfileInfo","exists","exec","push","manager"],"sources":["ios-config.ts"],"sourcesContent":["import * as fs from 'fs';\nimport * as path from 'path';\nimport { ModuleConfig } from './path-resolver';\n\nexport interface IOSConfigResult {\n  success: boolean;\n  message: string;\n  error?: string;\n  modifiedFiles?: string[];\n}\n\nexport class IOSConfigManager {\n  /**\n   * Configures Podfile to include the native module pod\n   */\n  public configurePodfile(\n    projectRoot: string, \n    moduleConfig: ModuleConfig\n  ): IOSConfigResult {\n    try {\n      const podfilePath = this.findPodfile(projectRoot);\n      if (!podfilePath) {\n        return {\n          success: false,\n          message: 'Podfile not found',\n          error: 'Could not locate Podfile in iOS project directory'\n        };\n      }\n\n      const content = fs.readFileSync(podfilePath, 'utf8');\n      \n      // Check if already configured\n      if (this.isAlreadyConfigured(content, moduleConfig)) {\n        return {\n          success: true,\n          message: 'Podfile already configured',\n          modifiedFiles: []\n        };\n      }\n\n      const modifiedContent = this.modifyPodfileContent(content, moduleConfig, projectRoot);\n      \n      // Create backup\n      const backupPath = `${podfilePath}.backup`;\n      fs.writeFileSync(backupPath, content);\n      \n      // Write modified content\n      fs.writeFileSync(podfilePath, modifiedContent);\n\n      return {\n        success: true,\n        message: `Successfully configured ${path.basename(podfilePath)}`,\n        modifiedFiles: [podfilePath]\n      };\n\n    } catch (error) {\n      return {\n        success: false,\n        message: 'Failed to configure Podfile',\n        error: error instanceof Error ? error.message : String(error)\n      };\n    }\n  }\n\n  /**\n   * Finds the Podfile in the iOS project\n   */\n  private findPodfile(projectRoot: string): string | null {\n    const iosPath = path.join(projectRoot, 'ios');\n    \n    if (!fs.existsSync(iosPath)) {\n      return null;\n    }\n\n    const podfilePath = path.join(iosPath, 'Podfile');\n    \n    if (fs.existsSync(podfilePath)) {\n      return podfilePath;\n    }\n\n    return null;\n  }\n\n  /**\n   * Checks if the Podfile is already configured with the module\n   */\n  private isAlreadyConfigured(content: string, moduleConfig: ModuleConfig): boolean {\n    // Look for pod reference with the module name\n    const podPattern = new RegExp(`pod\\\\s+['\"]${moduleConfig.name}['\"]`);\n    return podPattern.test(content);\n  }\n\n  /**\n   * Modifies the Podfile content to include the module pod\n   */\n  private modifyPodfileContent(\n    content: string, \n    moduleConfig: ModuleConfig, \n    projectRoot: string\n  ): string {\n    // Calculate relative path from iOS directory to module\n    const iosDir = path.join(projectRoot, 'ios');\n    const relativePath = path.relative(iosDir, moduleConfig.modulePath);\n    \n    // Create pod statement with path\n    const podStatement = `  pod '${moduleConfig.name}', :path => '${relativePath}'`;\n    \n    // Find the target block to add the pod to\n    const targetRegex = /target\\s+['\"][^'\"]+['\"]\\s+do([\\s\\S]*?)end/;\n    const match = content.match(targetRegex);\n    \n    if (match) {\n      // Add pod to the target block\n      const targetContent = match[1];\n      const newTargetContent = targetContent + '\\n' + podStatement + '\\n';\n      const modifiedContent = content.replace(\n        match[0],\n        match[0].replace(targetContent, newTargetContent)\n      );\n      return modifiedContent;\n    } else {\n      // If no target block found, try to find a general location to add the pod\n      // Look for existing pod statements and add after them\n      const podRegex = /pod\\s+['\"][^'\"]+['\"][^\\n]*\\n/g;\n      const pods = content.match(podRegex);\n      \n      if (pods && pods.length > 0) {\n        const lastPod = pods[pods.length - 1];\n        const lastPodIndex = content.lastIndexOf(lastPod);\n        const insertIndex = lastPodIndex + lastPod.length;\n        \n        return content.slice(0, insertIndex) + \n               podStatement + '\\n' + \n               content.slice(insertIndex);\n      } else {\n        // If no pods found, add at the end of the file\n        return content + '\\n' + podStatement + '\\n';\n      }\n    }\n  }\n\n  /**\n   * Validates that the iOS project structure is ready for pod configuration\n   */\n  public validateIOSProject(projectRoot: string): IOSConfigResult {\n    const iosPath = path.join(projectRoot, 'ios');\n    \n    if (!fs.existsSync(iosPath)) {\n      return {\n        success: false,\n        message: 'iOS project directory not found',\n        error: `Directory not found: ${iosPath}`\n      };\n    }\n\n    const podfilePath = path.join(iosPath, 'Podfile');\n    if (!fs.existsSync(podfilePath)) {\n      return {\n        success: false,\n        message: 'Podfile not found',\n        error: `Podfile not found at: ${podfilePath}`\n      };\n    }\n\n    // Check if Podfile is readable\n    try {\n      fs.readFileSync(podfilePath, 'utf8');\n    } catch (error) {\n      return {\n        success: false,\n        message: 'Podfile is not readable',\n        error: error instanceof Error ? error.message : String(error)\n      };\n    }\n\n    return {\n      success: true,\n      message: 'iOS project is ready for configuration'\n    };\n  }\n\n  /**\n   * Gets information about the current Podfile configuration\n   */\n  public getPodfileInfo(projectRoot: string): {\n    exists: boolean;\n    path?: string;\n    content?: string;\n    pods?: string[];\n  } {\n    const podfilePath = this.findPodfile(projectRoot);\n    \n    if (!podfilePath) {\n      return { exists: false };\n    }\n\n    try {\n      const content = fs.readFileSync(podfilePath, 'utf8');\n      \n      // Extract existing pod declarations\n      const podRegex = /pod\\s+['\"]([^'\"]+)['\"][^\\n]*/g;\n      const pods: string[] = [];\n      let match;\n      \n      while ((match = podRegex.exec(content)) !== null) {\n        pods.push(match[1]);\n      }\n\n      return {\n        exists: true,\n        path: podfilePath,\n        content,\n        pods\n      };\n    } catch (error) {\n      return { exists: true, path: podfilePath };\n    }\n  }\n}\n\n/**\n * Convenience function to configure Podfile\n */\nexport function configurePodfile(\n  projectRoot: string, \n  moduleConfig: ModuleConfig\n): IOSConfigResult {\n  const manager = new IOSConfigManager();\n  return manager.configurePodfile(projectRoot, moduleConfig);\n}\n\n/**\n * Convenience function to validate iOS project\n */\nexport function validateIOSProject(projectRoot: string): IOSConfigResult {\n  const manager = new IOSConfigManager();\n  return manager.validateIOSProject(projectRoot);\n}"],"mappings":"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","ignoreList":[]}